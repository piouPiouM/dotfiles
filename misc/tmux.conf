#!/usr/bin/env bash

# ── General settings ──────────────────────────────────────────────────────────────────────────────

# Set a new keybinding to C-a {{{
  unbind C-b
  set-option -g prefix C-a
  bind-key C-a send-prefix
# }}}

# address vim mode switching delay (http://superuser.com/a/252717/65504)
set -sg escape-time 0

# increase scrollback buffer size
set -g history-limit 50000

# tmux messages are displayed for 4 seconds
set -g display-time 4000

# add truecolor support
# See https://deductivelabs.com/en/2016/03/using-true-color-vim-tmux/
set -g default-terminal "screen-256color"
set -ga terminal-overrides ",*256col*:Tc"

# emacs key bindings in tmux command prompt (prefix + :) are better than
# vi keys, even for vim users
set -g status-keys emacs

# focus events enabled for terminals that support them
set-option -g focus-events on

# add mouse support
set -g mouse on

# start numbering at 1
set -g base-index 1
set -g pane-base-index 1

# don't rename windows automatically
#set-option -g allow-rename off

# Reload tmux config
bind r source-file ~/.tmux.conf \; display 'tmux configuration file sourced'

# enable vim mode
setw -g mode-keys vi

bind P paste-buffer
bind-key -t vi-copy 'v' begin-selection
bind-key -t vi-copy 'y' copy-selection
bind-key -t vi-copy 'r' rectangle-toggle

# rename session to git repo {{{
  unbind n
  bind-key n run-shell "tmux rename-session $(basename $(git rev-parse --show-toplevel))"
# }}}

# Copy mode with Prefix S
bind S copy-mode

# visual notification of activity in other windows {{{
  setw -g monitor-activity on
  set -g visual-activity on
# }}}

# PLUGINS



# THEME
#set -g status-bg black
#set -g status-fg white
#set -g window-status-current-bg white
#set -g window-status-current-fg black
#set -g window-status-current-attr bold
#set -g status-interval 60
#set -g status-left-length 30
#set -g status-left '#[fg=green](#S) #(whoami) '
#set -g status-right '#[fg=yellow]#(cut -d " " -f 1-3 /proc/loadavg)#[default] #[fg=white]%H:%M#[default]'

# ── Pane settings ─────────────────────────────────────────────────────────────────────────────────

# ── Status/Window settings ────────────────────────────────────────────────────────────────────────

#set-option -g status-position top

#set -g status-left-length 32
#set -g status-right-length 150

#set -g status-fg white
#set -g status-bg colour234
#set -g window-status-activity-attr bold
#set -g pane-border-fg colour245
#set -g pane-active-border-fg colour39
#set -g message-fg colour16
#set -g message-bg colour221
#set -g message-attr bold

# Status options {{{

  set-option -g status on
  set-option -g status-interval 2     # redraw status line every 10 seconds
  set-option -g status-justify "left"
  set-option -g status-left-length 500
  set-option -g status-right-length 500

# }}}

# Window options {{{

  # window is only constrained in size if a smaller client
  # is actively looking at it.
  setw -g aggressive-resize on
  setw -g automatic-rename on # rename window to reflect current program
  set -g renumber-windows on  # renumber windows when a window is closed
  set -g set-titles on                        # set terminal title
  set -g set-titles-string '#h ❐ #S ● #I #W'

# }}}

# Status and window appearance and style {{{

  set -g status-fg brightblack
  set -g status-bg black
  set -g pane-border-fg colour004
  set -g pane-active-border-fg colour009
  set -g message-fg red
  set -g message-bg black
  set -g message-attr bold

  set -g window-status-separator " "
  set -g window-status-bell-fg black
  set -g window-status-bell-bg brightred
  set -g window-status-activity-attr bold

  set -g window-status-fg brightwhite
  set -g window-status-bg black
  set -g window-status-current-fg black
  set -g window-status-current-bg brightblue
  set -g window-status-format " #I:#W "
  set -g window-status-current-format " ❐ #I:#W "

# }}}

# status line {{{

  set-option -g status-left "#($XDG_CONFIG_HOME/tmux/prompt.sh left)  "
  set-option -g status-right "#($XDG_CONFIG_HOME/tmux/prompt.sh right)"

# }}}

# Tmux plugins {{{

set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-urlview'
set -g @plugin 'tmux-plugins/tmux-online-status'
set -g @online_icon " "
set -g @offline_icon " "
set -g @plugin 'tmux-plugins/tmux-cpu'

# Check if tmux plugin manager is installed, otherwise clone it.
set-environment -g TMUX_PLUGIN_MANAGER_PATH "$XDG_DATA_HOME/tmux/plugins"
if "test ! -d  ${TMUX_PLUGIN_MANAGER_PATH}/tpm" \
   "run 'git clone https://github.com/tmux-plugins/tpm ${TMUX_PLUGIN_MANAGER_PATH}/tpm && ${TMUX_PLUGIN_MANAGER_PATH}/tpm/bin/install_plugins'"

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run "${TMUX_PLUGIN_MANAGER_PATH}/tpm/tpm"

# }}}

#set -g status-left '#[fg=colour235,bg=colour252,bold] ❐ #S #[fg=colour252,bg=colour238,nobold]⮀#[fg=colour245,bg=colour238,bold] #(whoami) #[fg=colour238,bg=colour234,nobold]⮀'
#set -g window-status-format "#[fg=white,bg=colour234] #I #W "
#set -g window-status-current-format "#[fg=colour234,bg=colour39]⮀#[fg=colour25,bg=colour39,noreverse,bold] #I ⮁ #W #[fg=colour39,bg=colour234,nobold]⮀"
#set -g status-right " #{online_status} | #{cpu_percentage} "


